================================================================================
                        SIGNALFRIEND FRONTEND TO-DO LIST
================================================================================

Last Updated: 2025-12-05
Branch: fix/rating-and-purchase-refresh (v0.1.4)

================================================================================
PHASE 1: CORE SCAFFOLD ✅ COMPLETE
================================================================================

[✅] Project Setup
    - Vite + React + TypeScript configuration
    - Tailwind CSS with dark theme
    - Path aliases (@/ for src/)

[✅] Web3 Integration
    - wagmi v2 configuration for BNB Chain
    - RainbowKit wallet connection UI
    - viem for blockchain interactions
    - Contract addresses config

[✅] Base UI Components
    - Button (5 variants: primary, secondary, danger, ghost, outline)
    - Input with label, error, helper text
    - Textarea
    - Select dropdown
    - Card with sub-components
    - Modal (accessible dialog)
    - Badge (status indicators)
    - Spinner / PageLoader
    - Avatar with fallback

[✅] Providers Setup
    - Web3Provider (wagmi + RainbowKit)
    - QueryProvider (TanStack Query)
    - SentryProvider (error boundary placeholder)

[✅] Router Setup
    - React Router v7 with placeholder pages
    - RootLayout with Header/Footer
    - Header with logo from branding assets
    - Routes: /, /signals, /predictors, /dashboard, /profile

[✅] API Layer
    - Axios client with interceptors
    - JWT token refresh logic
    - API endpoints configuration

[✅] State Management
    - Zustand auth store with persistence

[✅] Zod Schemas
    - API response schemas
    - Auth schemas
    - Signal schemas
    - Predictor schemas
    - Review schemas
    - Receipt schemas
    - Category schemas

[✅] Hooks
    - useAuth hook with SIWE authentication flow

[✅] Documentation
    - README.md with detailed setup instructions
    - PROJECT_CONTEXT.md
    - CHANGELOG.md
    - RUNBOOK.md
    - TO-DO-FRONTEND.txt (this file)

================================================================================
PHASE 2: AUTHENTICATION & WALLET ✅ COMPLETE
================================================================================

[✅] useAuth Hook Implementation
    - Login with wallet signature (SIWE)
    - Logout and disconnect wallet
    - Loading and error states
    - React Query mutation for async handling

[✅] Wallet Authentication Flow
    - Connect wallet button in header (RainbowKit)
    - AuthButton component (Connect → Sign In → Sign Out flow)
    - Sign message for authentication (SIWE pattern)
    - Auto-reconnect on page refresh (wagmi persistence)
    - Session sync on refresh (useSessionSync hook) - Fixed in v0.9.0

[✅] Auth API Integration
    - GET /api/auth/nonce - get signing nonce
    - POST /api/auth/verify - verify signature & get JWT
    - GET /api/auth/me - validate session token - Added in v0.9.0
    - Token storage in Zustand + localStorage
    - Proper API response unwrapping

[✅] Header Navigation
    - Shows "My Signals" and "Dashboard" only when authenticated
    - AuthButton shows correct state (Connect/Sign In/Sign Out)

[✅] JSDoc Documentation (Added in v0.3.0)
    - All UI components (Button, Input, Card, etc.)
    - Auth feature files (hooks, API, components, store)
    - Providers (Web3, Query, Sentry)
    - Router files (Header, RootLayout, index)
    - Config files (env, api.config, wagmi, contracts)
    - Hooks (useAuth, useIsAdmin, useIsPredictor)
    - Utils (cn, format)
    - API client and types/schemas
    - Each file includes examples, accessibility notes, flow diagrams

[✅] Protected Routes (Added in v0.4.0)
    - ProtectedRoute - requires wallet + SIWE auth
    - PredictorRoute - requires predictor registration
    - PredictorRoute (requireVerified) - requires verified status
    - AdminRoute - requires admin wallet address
    - All guards redirect with state (from path, message)
    - Added /become-predictor route for predictor registration

[✅] Landing Page (Added in v0.5.0)
    - HeroSection with tagline, value prop, CTAs, trust indicators
    - FeaturesSection with 6-card grid of key features
    - HowItWorksSection with tab-based Buyer/Predictor guides
    - CTASection with stats and final conversion CTA
    - HomePage composing all sections
    - Barrel exports for home feature
    - Router updated to use HomePage at root path

[ ] User Profile Page
    - Display wallet address
    - Show role/predictor status
    - Edit profile form (for predictors)

================================================================================
PHASE 3: SIGNALS FEATURE (PRIORITY: HIGH)
================================================================================

[✅] Signals List Page (/signals) - Added in v0.6.0
    - API functions (fetchSignals, fetchCategories, etc.)
    - React Query hooks (useSignals, useCategories)
    - SignalCard component with risk/reward badges
    - FilterPanel with category, risk, reward, price filters
    - SignalGrid with loading/empty/error states
    - Pagination component
    - SignalsPage combining all components
    - URL-synced filters (shareable/bookmarkable)
    - Mobile-responsive collapsible filters

[✅] Signal Detail Page (/signals/:contentId) - Added in v0.7.0
    - SignalDetailPage with full signal info
    - SignalDetailSkeleton for loading state
    - PredictorInfoCard with avatar, stats, bio
    - PurchaseCard with dynamic button states
    - SignalContent with locked/unlocked views
    - Breadcrumb navigation
    - Share buttons (copy link, Twitter)
    - Error state for missing signals

[✅] Purchase Flow - Added in v0.8.0
    - Contract ABIs (SignalFriendMarket, ERC20) in shared/config/abis
    - Purchase API functions (fetchContentIdentifier, checkPurchase, fetchMyReceipts)
    - React Query hooks for purchase flow:
      - useCheckPurchase - check if user owns signal
      - useContentIdentifier - get bytes32 for on-chain call
      - useUSDTBalance - check user's USDT balance
      - useUSDTAllowance - check spending allowance
      - useApproveUSDT - approve USDT spending
      - useBuySignal - execute buySignalNFT contract call
      - usePurchaseFlow - combined hook for entire flow
    - PurchaseModal component with multi-step flow:
      - Balance check step
      - USDT approval step (if needed)
      - Purchase execution step
      - Success/error states
    - SignalDetailPage integration:
      - Real ownership check via useCheckPurchase
      - Purchase modal trigger
      - Auto-refresh on successful purchase
    - Backend endpoint: GET /api/signals/:contentId/content-identifier

[✅] My Purchased Signals - Added in v0.8.2
    - useMyReceipts hook to fetch user's purchase receipts
    - PurchasedSignalCard component with owned badge, purchase info, links
    - MyPurchasedSignalsPage at /my-signals route:
      - Grid of purchased signals
      - Sort by date or price
      - Empty state with marketplace CTA
      - Loading skeleton
      - Error handling
    - Router updated with real page (replaces placeholder)
    - "View Signal" links to unlocked content on detail page
    - "View TX" links to BSCScan explorer

[✅] User-Friendly Transaction Errors - Added in v0.10.4
    - walletErrors.ts utility for parsing wallet errors
    - Detects user rejection, insufficient funds, network errors
    - PurchaseModal shows clean error messages instead of raw technical data
    - User rejections shown as yellow "Transaction Cancelled" (not scary red)
    - parseWalletError() and isUserRejectionError() exported for reuse

[✅] Leave Rating Functionality - Added in v0.1.0 (feature/rating-system)
    - StarRating component (shared/components/ui) with interactive + read-only modes
    - Reviews API (reviews.api.ts) with checkReviewExists, getReviewByTokenId, createReview
    - React Query hooks (useReviews.ts) with useCheckReview, useGetReview, useCreateReview
    - RatingSection component with confirmation dialog (ratings are PERMANENT)
    - Integrated into SignalDetailPage below SignalContent for purchased signals
    - Ratings tied to SignalKeyNFT tokenId (one rating per purchase)
    - Cannot update or delete ratings (prevents manipulation)
    - Submit rating to backend API
    - One rating per purchase (enforced by tokenId)

[✅] Purchased Signals Display - Added in v0.1.1 (fix/predictor-signals-display)
    - Receipts API (receipts.api.ts) with getMyReceipts, getMyPurchasedContentIds
    - React Query hook (useReceipts.ts) with useMyPurchasedContentIds
    - SignalCard updated with isPurchased prop and "Purchased" badge
    - SignalGrid updated with purchasedContentIds prop for O(1) lookup
    - PredictorProfilePage now shows ALL signals (removed excludeBuyerAddress filter)
    - Purchased signals display "Purchased" badge instead of "Active"
    - Fixed bug where predictor profile showed "No signals found" after purchasing all

================================================================================
PHASE 4: PREDICTOR FEATURES (PRIORITY: MEDIUM)
================================================================================

[✅] Predictor List Page (/predictors) - Added in v0.11.0
    - Fetch predictors with stats via usePredictors hook
    - Filter by search, quick filters (Top Sellers, Best Rated, New)
    - Sort by sales, rating, signals, newest
    - PredictorCard with avatar, stats, rank badges
    - Pagination with URL-synced filters
    - Mobile-responsive filter panel

[✅] Predictor Profile Page (/predictors/:wallet) - Added in v0.12.0
    - Full profile info (avatar, name, bio, verification badge)
    - Statistics (Signals, Sales, Avg Rating, Votes)
    - Active signals grid with full FilterPanel (same as marketplace)
    - URL-synced filters, pagination, mobile-responsive
    - Twitter social link display
    - No text reviews (rating only to avoid moderation issues)

[ ] Become a Predictor Flow
    - Check if user owns PredictorAccessPass NFT
    - If not, show purchase option
    - Call registerPredictor contract method
    - Update role in backend

[✅] Predictor Dashboard (/dashboard - predictor only) - Added in v0.9.0
    - Dashboard stats overview (signals, sales, earnings, rating)
    - My Signals grid with filter tabs (all/active/inactive)
    - Signal management (view, deactivate, reactivate)
    - Create Signal modal (available to all predictors)
    - API functions for signal CRUD operations
    - React Query hooks (useMySignals, useMyEarnings, useCreateSignal, etc.)
    - DashboardStats component with animated stat cards
    - MySignalCard component with expiry tracking
    - CreateSignalModal with full form validation
    - Verification badge display for verified predictors
    - Empty state with CTA for first signal
    - Router updated with real PredictorDashboardPage

[✅] Auth Persistence Fix - Fixed in v0.9.0
    - Backend now returns predictor data on /api/auth/verify
    - Predictor data persisted to localStorage with JWT
    - Route guards wait for Zustand hydration before redirect
    - useSessionSync validates token on page refresh
    - No more redirect flash or manual reconnect needed

================================================================================
PHASE 5: RATINGS (PRIORITY: MEDIUM)
================================================================================

NOTE: Rating system is STAR RATING ONLY (1-5 stars), no text reviews.
This avoids moderation issues (spam links, inappropriate content).

[ ] Rating System
    - Star rating component (1-5 stars)
    - Rating form after purchase (simple star selection)
    - Submit rating to API
    - Display average rating and vote count on predictor cards/profiles

[ ] Rating Display
    - Average rating badge (already shown)
    - Total votes count (already shown)
    - Rating breakdown chart (optional - shows distribution of 1-5 star votes)

================================================================================
PHASE 6: ADMIN FEATURES (PRIORITY: LOW)
================================================================================

[ ] Admin Dashboard (/admin - admin only)
    - Platform statistics
    - User management
    - Signal moderation
    - Category management

[ ] Verification Management
    - Pending verifications list
    - Approve/reject predictor
    - Blacklist functionality

[ ] Reports Management
    - View reported content
    - Take action on reports

================================================================================
PHASE 7: POLISH & OPTIMIZATION (PRIORITY: LOW)
================================================================================

[ ] Performance
    - React.lazy for route splitting
    - Image optimization
    - Query caching strategies
    - Debounced search inputs

[ ] UX Improvements
    - Toast notifications
    - Loading skeletons
    - Optimistic updates
    - Error recovery

[ ] Accessibility
    - Keyboard navigation
    - Screen reader support
    - Focus management
    - ARIA labels

[ ] Mobile Responsiveness
    - Mobile navigation menu
    - Touch-friendly interactions
    - Responsive layouts

[ ] SEO & Meta
    - React Helmet for meta tags
    - Open Graph tags
    - Twitter cards

================================================================================
KNOWN ISSUES / BUGS
================================================================================

[✅] FIXED: SignalCard shows "Expired" for all signals (v0.8.1)
    - Location: src/features/signals/components/SignalCard.tsx
    - Problem: getExpiryInfo() was called with createdAt date (always in the past)
    - Solution: Added expiresAt field to backend Signal model
    - Predictors now set expiryDays (1-30) when creating signals
    - SignalCard and SignalDetailPage now use real expiresAt
    - Migration script added for existing signals

[✅] FIXED: Unauthenticated users redirected from signal detail page (v0.9.6)
    - Location: src/features/signals/hooks/usePurchase.ts, src/shared/api/apiClient.ts
    - Problem: Protected API hooks fired before auth store hydrated, causing 401s
    - Solution: Added hasHydrated + hasToken checks to all protected hooks
    - Also updated apiClient to not redirect on 401 for public endpoints

[✅] FIXED: Price input can't enter trailing decimals (v0.9.6)
    - Location: src/features/predictors/components/CreateSignalModal.tsx
    - Problem: type="number" with valueAsNumber strips trailing zeros on each keystroke
    - Solution: Changed to type="text" with inputMode="decimal" + custom validation

[✅] FIXED: SignalCard layout inconsistent (footer at different heights) (v0.9.6)
    - Location: src/features/signals/components/SignalCard.tsx
    - Problem: Variable title lengths and verbose expiry text caused cards to have different heights
    - Solution: Added h-full + mt-auto, min-h on title, abbreviated expiry format (e.g., "Expires in 8h")

[✅] FIXED: Predictor sales not showing on signal detail page (v0.12.1)
    - Location: Backend signal.service.ts + frontend PredictorInfoCard.tsx
    - Problem: Signal detail API only populated minimal predictor fields (missing totalSales, totalReviews, bio, isVerified)
    - Solution: Backend now populates all PredictorInfoCard fields; frontend uses totalSales with fallback

[✅] FIXED: Stale data shown after wallet switch (v0.1.2)
    - Location: src/features/auth/api/authHooks.ts (useSessionSync)
    - Problem: When user switched wallets, they were logged out but stayed on current page with stale data
    - Example: Predictor profile showed "Purchased" badges for signals bought by OLD wallet
    - Solution: useSessionSync now redirects to home page on wallet change via router.navigate('/')
    - User must sign in again with new wallet to get fresh data

[✅] FIXED: 401 error when visiting predictor profile with connected but unsigned wallet (v0.1.3)
    - Location: src/features/predictors/pages/PredictorProfilePage.tsx
    - Problem: useMyPurchasedContentIds hook was enabled when wallet was connected (not signed in)
    - Root cause: Hook checked !!connectedWallet but API requires SIWE authentication
    - Solution: Changed to check isAuthenticated from useAuthStore instead of wallet connection
    - Also improved useSessionSync to only track addresses when authenticated

[✅] FIXED: Rating submission doesn't update UI without page refresh (v0.1.4)
    - Location: src/features/signals/hooks/useReviews.ts
    - Problem: After rating a signal, predictor profile and signal detail didn't show updated rating
    - Root cause: Only review-specific queries were invalidated, not signal/predictor queries
    - Solution: useCreateReview now invalidates signal detail, predictor profile, and signal lists

[✅] FIXED: Purchase not reflected in UI when API rate-limited (v0.1.4)
    - Location: src/features/signals/hooks/usePurchase.ts
    - Problem: Blockchain transaction succeeded but UI didn't update due to API rate limiting
    - Root cause: Cache invalidation happened immediately, but webhook might not have processed yet
    - Solution: Added multiple delayed cache invalidations (2s, 5s, 10s) after purchase confirmation
    - Test: Use scripts/trigger-rate-limit.sh to simulate rate limiting during purchase

================================================================================
TECHNICAL DEBT
================================================================================

[ ] Add comprehensive error handling to all API calls
[ ] Add unit tests for components
[ ] Add integration tests for flows
[ ] Add E2E tests with Playwright
[ ] Set up Sentry error tracking (currently placeholder)
[ ] Configure proper CSP headers
[ ] Add rate limiting feedback to users

================================================================================
DEPENDENCIES TO WATCH
================================================================================

- wagmi: Currently v2, watch for v3 updates
- RainbowKit: Keep in sync with wagmi version
- viem: Core blockchain library
- TanStack Query: v5, stable
- Zustand: v4, stable
- React Router: v6, stable

================================================================================
NOTES
================================================================================

1. Always test wallet flows on BSC Testnet (chainId: 97) before mainnet
2. Use the WalletConnect projectId from .env.local for wallet connections
3. API URL defaults to http://localhost:3001 for local development
4. Frontend runs on port 5173 (Vite default)

================================================================================
